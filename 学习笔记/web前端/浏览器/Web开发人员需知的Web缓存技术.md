### Web开发人员需知的Web缓存技术

#### 1. 什么是Web缓存，为什么使用它？

Web缓存游走于服务器和客户端之间。服务器可能是源服务器（资源所驻留的服务器），数量可能是多个；而客户端也可能是多个。Web缓存在服务器-客户端之间监控请求，并把请求输出的内容（如HTML页面文件，CSS、JS、图片等资源，统称为副本）另存一份。如果下一次请求是相同的URL，则直接请求保存的副本，而不是再次麻烦源服务器。

使用缓存的原因：

* 降低延迟：缓存离客户端更近，从缓存请求内容比从源服务器所用时间更少，页面呈现速度更快，网站显得更灵敏。
* 降低网络传输，减少网络流量。

#### 2. 缓存类型

* `浏览器缓存`——浏览器在客户端硬盘上开辟一个空间专门存储资源副本
* `代理服务器缓存`——大公司和ISP提供，规模更大、用户量大，属于共享缓存。不属于客户端或源服务器一部分，需要以某种方式路由到代理服务器，如手动设置常用代理服务器或使用拦截代理。
* `网关缓存`——也叫“反向代理缓存”或“替代缓存”，起中介作用，一般由网站管理员而不是网络管理员部署。可以通过多种方法把请求路由到网关缓存，但通常使用某种形式的负载均衡器，使它们中的一个或多个看起来像是源服务器。内容分发网络（CDN）为整个网络（或部分）分配网关缓存，然后把缓存卖给需要的网站。

#### 3. Web缓存无害吗？为什么要鼓励使用缓存？

缺点：缓存会隐藏用户信息，使得网站管理员无法跟踪用户；缓存的内容可能是旧的过时的。

#### 4. Web缓存如何工作？

规则：

* 响应头明确说明。
* 若请求信息是需要认证或者安全加密的（如HTTPS），内容不会被缓存。
* 缓存含有完整过期时间和缓存控制信息，且时间有效，则内容缓存直取。
* 若内容陈旧，则要求源服务器做验证，告诉缓存器拷贝副本是否要更新。
* 特定情况下，如断网，之前的响应缓存直取而不检查源服务器。

#### 5. 如何控制缓存和不缓存？

* HTML Meta标签（效果不佳） vs. HTTP头信息
* Pragma HTTP头信息（效果不佳）
* 使用Expires HTTP头信息控制不过期，唯一有效值为HTTP时间（格林威治时间格式GMT）
* Cache-Control（缓存控制）HTTP头信息（max-age, s-maxage, public, private, no-cache, no-store, must-revalidate, proxy-revalidate），优先级高于Expires
* 验证器和验证——Last-Modified（常用），Etag

> 所有新一代Web服务器都对静态内容（如：文件）自动生成Etag和Last-Modified头信息，而你不必做任何设置。但是，服务器对于动态内容（如：CGI, ASP或数据库生成的网站）并不知道如何生成这些信息。

#### 6. 创建支持缓存网站的小技巧

使用新鲜度信息和验证器，此外：

* 保持URL稳定
* 不同地方的图片和其他元素使用同一库
* 对于不经常改变的图片/页面启用缓存，max-age设大一点
* 对于定期更新的内容指定max-age或过期时间实现缓存
* 如果资源改变了（尤其下载文件），改变其名字——这种资源一般会有很长的过期时间
* 万不得已不要变动文件
* 少用Cookie
* 减少SSL的使用，因为共享缓存不能存储认证页面
* 使用REDbot检查网站HTTP资源

#### 7. 编写支持缓存的脚本



#### 参考资料

[Web开发人员需知的Web缓存知识](http://www.kuqin.com/web/20130616/334590.html)

[浏览器缓存机制](http://www.cnblogs.com/skynet/archive/2012/11/28/2792503.html)



